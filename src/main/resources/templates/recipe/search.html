<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Yummy - ë ˆì‹œí”¼ ê²€ìƒ‰</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> 
    <style>
        .search-container { text-align: center; padding: 30px; background-color: #f8f9fa; border-radius: 10px; margin-bottom: 20px; }
        .search-input { width: 60%; padding: 10px; font-size: 16px; border: 1px solid #ddd; border-radius: 5px; }
        .search-btn { padding: 10px 20px; font-size: 16px; background-color: #ff6b6b; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .recipe-item { border: 1px solid #eee; padding: 15px; margin-bottom: 10px; border-radius: 5px; }
        .recipe-title { font-size: 1.2em; font-weight: bold; color: #333; text-decoration: none; }
        .favorite-btn.favorite { background-color: #ffda00; }
        /* ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ìŠ¤íƒ€ì¼ */
        .nav-links { margin-bottom: 20px; text-align: right; }
        .nav-links a { margin-left: 15px; text-decoration: none; color: #555; font-weight: bold; }
    </style>
</head>
<body>

    <div class="nav-links">
        <a th:href="@{/recipe/search}">ğŸ” ë ˆì‹œí”¼ ê²€ìƒ‰</a>
        <a th:href="@{/recipe/category}">ğŸ“‚ ë¶„ë¥˜ë³„ ë ˆì‹œí”¼</a>
        <a th:href="@{/recipe/favorites}">â­ ì¦ê²¨ì°¾ê¸°</a>
        <a th:href="@{/fridge/list}">ğŸ¥¦ ëƒ‰ì¥ê³ </a>
    </div>

    <h2>ë ˆì‹œí”¼ ê²€ìƒ‰</h2>

    <div class="search-container">
        <form th:action="@{/recipe/search}" method="get">
            <input type="text" name="keyword" class="search-input" 
                   th:value="${keyword}" placeholder="ìš”ë¦¬ëª… ì…ë ¥ (ì˜ˆ: ëœì¥ì°Œê°œ)">
            <button type="submit" class="search-btn">ê²€ìƒ‰</button>
        </form>
    </div>

    <h3 th:text="${searchMessage}"></h3>
    
    <div th:if="${recipeList != null and !recipeList.empty}">
        <div th:each="recipe : ${recipeList}" class="recipe-item">
            <div class="recipe-title">
                <a th:href="@{/recipe/detail/{id}(id=${recipe.recipeId})}" th:text="${recipe.name}">ë ˆì‹œí”¼ ì´ë¦„</a>
            </div>
            <div>
                ì¡°ë¦¬ì‹œê°„: <span th:text="${recipe.time} + 'ë¶„'"></span> |
                ì¸ë¶„: <span th:text="${recipe.serving} + 'ì¸ë¶„'"></span>
            </div>
            <button th:attr="data-recipe-id=${recipe.recipeId}" 
                    class="favorite-btn"
                    onclick="toggleFavorite(this)">â­ ì¦ê²¨ì°¾ê¸° ì¶”ê°€/í•´ì œ</button>
        </div>
    </div>
    
    <div th:if="${keyword != null and (recipeList == null or recipeList.empty)}">
        <p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
    </div>

    <script>
        function toggleFavorite(button) {
            const recipeId = $(button).data('recipe-id');
            $.ajax({
                url: '/recipe/toggleFavorite',
                type: 'POST',
                data: { recipeId: recipeId },
                dataType: 'json',
                success: function(response) {
                    if (response.status === 'UNAUTHORIZED' && response.redirectUrl) {
                        if(confirm(response.message)) window.location.href = response.redirectUrl;
                        return;
                    }
                    if (response.status === 'OK') {
                        alert(response.message);
                        if (response.isFavorite) $(button).addClass('favorite').text('â­ï¸ ì¦ê²¨ì°¾ê¸° í•´ì œ');
                        else $(button).removeClass('favorite').text('â­ ì¦ê²¨ì°¾ê¸° ì¶”ê°€');
                    }
                },
                error: function() { alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."); }
            });
        }
    </script>
</body>
</html>